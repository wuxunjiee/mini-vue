{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\n\nlet oldArrayProto = Array.prototype;\n\nexport let newArrayProto = Object.create(oldArrayProto);\n\n// 数组中所有的变异方法\nconst methods = [\n  \"push\",\n  \"pop\",\n  \"shift\",\n  \"unshift\",\n  \"reverse\",\n  \"sort\",\n  \"splice\",\n];\n\n// 面向切片编程\nmethods.forEach((method) => {\n  newArrayProto[method] = function (...args) {\n    let inserted;\n    const ob = this.__ob__;\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        inserted = args;\n        break;\n      case \"splice\":\n        inserted = args.slice(2);\n      default:\n        break;\n    }\n    if (inserted) ob.observeArray(inserted);\n    return oldArrayProto[method].call(this, ...args);\n  };\n});\n","import { newArrayProto } from \"./array\";\n\nclass Observer {\n  constructor(data) {\n    Object.defineProperty(data, \"__ob__\", {\n      value: this,\n      // 将__ob__变价不可枚举的属性，否则会死循环\n      enumerable: false,\n    });\n    // 两个效果，一是在数组的重写方法内可以调用observeArray，二是给数据加了标识，有这个属性则说明被观测过，不需要再被观测了\n    // data.__ob__ = this;\n    if (Array.isArray(data)) {\n      data.__proto__ = newArrayProto;\n      // 如果数组中放的是对象，可以监控到对象的变化\n      this.observeArray(data);\n    } else {\n      this.walk(data);\n    }\n  }\n  walk(data) {\n    Object.keys(data).forEach((key) => defineReactive(data, key, data[key]));\n  }\n  observeArray(data) {\n    data.forEach((item) => observe(item));\n  }\n}\n\nexport function defineReactive(target, key, value) {\n  observe(value);\n  Object.defineProperty(target, key, {\n    get() {\n      return value;\n    },\n    set(newVal) {\n      if (value === newVal) return;\n      observe(newVal);\n      value = newVal;\n    },\n  });\n}\n\nexport function observe(data) {\n  // 只对对象劫持\n  if (typeof data !== \"object\" || data === null) return;\n  // 如果一个对象被劫持过了，就不需要再被劫持了\n  // 判断一个对象是否被劫持过，添加增添一个实例，用实例来判断是否被劫持过\n  if (data.__ob__ instanceof Observer) {\n    return data.__ob__;\n  }\n  return new Observer(data);\n}\n","import { observe } from \"./observe\";\n\n/**\n * @description 初始化data,props,computed等状态\n */\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\n\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key];\n    },\n    set(newVal) {\n      if (vm[target][key] === newVal) return;\n      vm[target][key] = newVal;\n    },\n  });\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  data = typeof data === \"function\" ? data.call(vm) : data;\n  vm._data = data;\n  observe(data);\n  for (const key in data) {\n    if (Object.hasOwnProperty.call(data, key)) {\n      proxy(vm, \"_data\", key);\n    }\n  }\n}\n","import { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n  /**\n   * @description 初始化Vue\n   */\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n    initState(vm);\n  };\n}\n","import { initMixin } from \"./init\";\n\n/**\n * @param options 用户的选项\n */\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","inserted","ob","__ob__","args","slice","observeArray","call","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newVal","initState","vm","opts","$options","initData","proxy","_data","hasOwnProperty","initMixin","Vue","_init","options"],"mappings":"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"}